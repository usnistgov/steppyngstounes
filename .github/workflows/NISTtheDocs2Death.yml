name: "NISTtheDocs2Death"

on: [push, pull_request]

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: usnistgov/sphinx-action@master
        with:
          docs-folder: docs/
      - uses: usnistgov/sphinx-action@master
        with:
          docs-folder: docs/
          build-command: make epub
      - uses: usnistgov/sphinx-action@master
        with:
          docs-folder: docs/
          pre-build-command: |
            apt-get update \
             && apt-get install --no-install-recommends -y \
                  graphviz \
                  imagemagick \
                  make \
                  \
                  latexmk \
                  lmodern \
                  ghostscript \
                  gsfonts \
                  fonts-freefont-otf \
                  texlive-latex-recommended \
                  texlive-latex-extra \
                  texlive-fonts-recommended \
                  texlive-fonts-extra \
                  texlive-lang-cjk \
                  texlive-lang-chinese \
                  texlive-lang-japanese \
                  texlive-luatex \
                  texlive-xetex \
                  texlive-science \
                  texlive-extra-utils \
                  xindy \
                  tex-gyre \
             && apt-get autoremove \
             && apt-get clean \
             && rm -rf /var/lib/apt/lists/* \
             && convert -list delegate | grep 'svg ='
          build-command: "make latexpdf"
      - uses: usnistgov/NISTtheDocs2Death@main
        with:
          docs-folder: docs/
      - uses: actions/upload-artifact@v1
        with:
          name: DocumentationPDF
          path: docs/_build/pdf/
      - uses: actions/upload-artifact@v1
        with:
          name: DocumentationEPUB
          path: docs/_build/epub/
